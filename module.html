<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Designing module systems</title>
  <meta name="description" content="Personal website">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://edom.github.io/module.html">
  <link rel="alternate" type="application/rss+xml" title="Erik Dominikus&#39;s wiki" href="/feed.xml">

  

  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-12628443-6', 'auto');
  ga('send', 'pageview');

</script>
  

  

  
</head>


  <body>

    <header class="site-header" role="banner">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">Erik Dominikus&#39;s wiki</a>
  </div>
</header>


    

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Designing module systems</h1>
  </header>

  <div class="post-content">
    <p>What is a module?
Or, should we be asking these questions instead?</p>

<ul>
  <li>How do we decompose a program? (I think David Parnas has answered this.)</li>
  <li>Why do we need modules?</li>
  <li>How do we organize programs?</li>
</ul>

<p>Modules reduce complexity by partitioning and independence.
See <a href="http://www.computing.dcu.ie/~renaat/ca2/ca214/ca214vii.html">Three Universal methods of reducing complexity</a>
from the course <a href="http://www.computing.dcu.ie/~renaat/ca2/ca214over.html">CA214 Systems Analysis and Design Page</a>.</p>

<p>What do others say?</p>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/Module">Wikipedia</a></li>
  <li>According to <a href="https://en.wiktionary.org/wiki/module">Wiktionary</a>:
    <ul>
      <li>The word “module” is from Latin “modulus” that means “a small measure”.</li>
      <li>A module is “a self-contained component of a system, often interchangeable, which has a well-defined interface to the other components”.</li>
    </ul>
  </li>
  <li><a href="https://www.dictionary.com/browse/module">dictionary.com</a></li>
</ul>

<p>What do we infer?</p>

<ul>
  <li>We can develop different modules at the same time.</li>
</ul>

<h2 id="philosophical-investigation">Philosophical investigation</h2>

<ul>
  <li>What are the properties of a module?</li>
  <li>What are its relationships with other things?
    <ul>
      <li>interchangeability</li>
    </ul>
  </li>
  <li>A module groups things.
    <ul>
      <li>Is this essential or accidental?
  Is it made for grouping?
  Is grouping only a side-effect?</li>
    </ul>
  </li>
  <li>What can we do with modules?
    <ul>
      <li>We can combine modules.</li>
      <li>We can shadow modules.</li>
      <li>We can link modules.</li>
      <li>We can embed/inline modules.</li>
    </ul>
  </li>
  <li>A module is an incomplete/dependent piece of functionality/code.
    <ul>
      <li>A module may have unresolved symbols?</li>
    </ul>
  </li>
  <li>A module is a decomposition of a program?</li>
  <li>Module is about reusability?</li>
  <li>A program is a module and a starting point.</li>
  <li>A module specifies a contract.
A module can be swapped with another module that satisfies the same contract without changing the correctness of the program.</li>
  <li>A module is a bunch of imports and exports?</li>
  <li>A module is smallest unit of reuse? Isn’t that function?</li>
  <li>A module is smallest unit of compilation? Isn’t that function?</li>
</ul>

<h2 id="modules-are-for-humans">Modules are for humans</h2>

<p>Computers don’t need modules.
All it needs is a sequence of machine codes.</p>

<p>A program is a lambda expression.
A big program is a big lambda expression.
Given enough memory, a computer can handle arbitrarily big lambda expressions.</p>

<p>Human uses modules for organizing things.
Human uses modules to make machines separate compilation, speed up recompilation, and recompile a part of the program.</p>

<ul>
  <li>Does a module have to coincide with a compilation unit?</li>
  <li>Basic module functions?
    <ul>
      <li>How does a code describe its dependencies?</li>
      <li>How does the machine disambiguate names?</li>
      <li>Functions should be versioned. Not module. Not package.
  Version describes semantics.</li>
    </ul>
  </li>
</ul>

<p>Module is second-order logic programming?
Note below, that the same <code class="highlighter-rouge">Plus</code> is used as both a variable and a predicate.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export(module_name, type, name, value).

export(prelude, int, plus, Plus) |- export(my_module, int, three, Plus(1, 2)).
</code></pre></div></div>

<ul>
  <li>The smallest unit for this discussion is a machine instruction.</li>
  <li>A subroutine is a collection of instructions.</li>
  <li>A library is a collection of subroutines.</li>
  <li>A program is a collection of libraries and an entry point.</li>
  <li>History
    <ul>
      <li>The initial motivation was to reuse.
        <ul>
          <li>Reduce development cost.
            <ul>
              <li>Humans have always been looking for easier ways to live.
  This “laziness” (the ability to get bored repeating something) is the source of all human technology.</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>The next motivation was to reduce disk and memory usage.</li>
    </ul>
  </li>
  <li>The essence of programming-in-the-large is Don’t Repeat Yourself?</li>
</ul>

<h2 id="comparing-existing-module-systems">Comparing existing module systems</h2>

<p>How do programming languages deal with modules?</p>

<ul>
  <li><a href="https://github.com/dhall-lang/dhall-lang/issues/182">dhall modules · Issue #182 · dhall-lang/dhall-lang</a></li>
  <li><a href="https://futhark-lang.org/blog/2017-01-25-futhark-module-system.html">Futhark</a></li>
  <li><a href="https://elixir-lang.org/getting-started/modules-and-functions.html">Elixir</a>
    <ul>
      <li><a href="https://hexdocs.pm/elixir/Module.html">Module – Elixir v1.7.2</a></li>
    </ul>
  </li>
  <li>Racket
    <ul>
      <li>2011, article, “Languages as Libraries”, <a href="http://www.cs.utah.edu/plt/publications/pldi11-tscff.pdf">pdf</a></li>
    </ul>
  </li>
  <li>Scheme R7RS, Common Lisp, Clojure</li>
  <li>Java, Scala, Kotlin, Go, C, C++
    <ul>
      <li>C ABI
        <ul>
          <li>A module is an ELF shared object file (SO file).</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Pascal, Ada, Oberon, Algol, Fortran</li>
  <li>JavaScript, TypeScript, ECMAScript</li>
  <li>Standard ML, Caml, OCaml, MLTON, SML/NJ, F#
    <ul>
      <li>2000, “A modular module system”, <a href="https://hal.inria.fr/hal-01499946/document">pdf</a></li>
    </ul>
  </li>
  <li>Haskell has underpowered module system.</li>
  <li>book, “Advanced topics in types and programming languages”, part IV, programming in the large, <a href="http://camlunity.ru/swap/Functional%20Programming/Type%20Systems/Pierce/Advanced%20Topics%20in%20Types%20and%20Programming%20Languages.pdf">pdf</a>
    <ul>
      <li>book, “Types and programming languages”, <a href="https://www.asc.ohio-state.edu/pollard.4/type/books/pierce-tpl.pdf">pdf</a></li>
    </ul>
  </li>
  <li><a href="https://en.wikipedia.org/wiki/Modular_programming">WP:Modular programming</a></li>
</ul>

<h2 id="key-idea-module--dictionary---dictionary">Key idea: Module = Dictionary -&gt; Dictionary</h2>

<p>Assume a dependently-typed language.</p>

<p>Recall some terminologies:</p>

<ul>
  <li>A record is a tuple whose components are named.</li>
  <li>A dictionary is also known as key-value map or look-up table.</li>
</ul>

<p>Then a module is a lambda abstraction that takes a record and gives a record.</p>

<p>A module is a lambda abstraction.</p>

<p>This idea is similar to Nix and JavaScript modules.</p>

<p><code class="highlighter-rouge">type Module = Map Name Decl -&gt; Map Name Decl</code></p>

<p>A module translates into a lambda-calculus expression.
An import translates to an entry in the input dictionary.
An export translates to an entry in the output dictionary.
Example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module {
    import add mul Int32;
    export f g T;
    f = add;
    g = mul;
    T = Int32;
};

-- The expression above translates to:

\ {add; mul; Int32; ...} -&gt; {
    f = add;
    g = mul;
    T = Int32;
};
</code></pre></div></div>

<ul>
  <li>Key ideas of that example:
    <ul>
      <li>Dictionary pattern matching simulates row polymorphism.</li>
      <li><code class="highlighter-rouge">{a;b;c;}</code> is shorthand for <code class="highlighter-rouge">{a:a; b:b; c:c;}</code>.</li>
      <li><a href="https://blog.robphoenix.com/elixir/notes-on-elixir-pattern-matching-maps/">Notes on Elixir: Pattern-Matching Maps · Rob Phoenix</a></li>
    </ul>
  </li>
</ul>

<p>What we are doing here is also known as “blurring the phase distinction”.
See <a href="https://futhark-lang.org/blog/2017-01-25-futhark-module-system.html#modules-versus-higher-order-functions">“Modules versus Higher-Order Functions” in Futhark blog post</a>:
“A module can be viewed as nothing but a record containing types and values.”</p>

<p>A problem: compilation may fail to terminate.
No big deal.
Set a time-out.</p>

<h2 id="what">what</h2>

<ul>
  <li>Hypothesis: Lazy evaluation solves the partial query problem elegantly.</li>
  <li>What are some cool ideas?
    <ul>
      <li>Dhall can import from IPFS.
        <ul>
          <li>http://www.haskellforall.com/2016/12/dhall-non-turing-complete-configuration.html</li>
        </ul>
      </li>
      <li>Elixir can pattern-match maps (dictionaries).</li>
    </ul>
  </li>
  <li>What is a module in an untyped functional programming language such as Tulip?</li>
  <li>Finding a programming language for programming in the large
    <ul>
      <li>Ecosystem, libraries, tools, and communities.</li>
      <li>The most important thing in programming in the large is name management.
  Namespaces.
        <ul>
          <li>C has two namespaces: type namespace and value namespace.</li>
          <li>Haskell has two namespaces: type namespace and value namespace.</li>
          <li>Java has better namespacing than C.</li>
          <li>Enable the same name to be used in different context, so that you can write <code class="highlighter-rouge">get_name employee</code> and <code class="highlighter-rouge">get_name company</code> instead of <code class="highlighter-rouge">employee_get_name employee</code> or <code class="highlighter-rouge">company_get_name company</code>.
            <ul>
              <li>Ad-hoc polymorphism.</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Which one has the biggest community?</li>
      <li>Which one has a decent IDE?</li>
      <li>Which community puts their money on where their mouth is?</li>
      <li>Comparing type systems
        <ul>
          <li><a href="https://docs.racket-lang.org/ts-guide/">The Typed Racket Guide</a></li>
          <li>F#</li>
          <li>SML</li>
          <li>Caml</li>
          <li>OCaml</li>
          <li>Idris, Agda</li>
          <li>Coq, Lean</li>
          <li>Haskell</li>
          <li>2004, chapter, “Type systems”, Luca Cardelli, <a href="http://lucacardelli.name/Papers/TypeSystems.pdf">pdf</a>
            <ul>
              <li>from https://www.artima.com/forums/flat.jsp?forum=106&amp;thread=185420</li>
              <li>2005, book, “Advanced topics in types and programming languages”, Benjamin C. Pierce (editor)
                <ul>
                  <li>Part IV, “Types for Programming in the Large”</li>
                </ul>
              </li>
              <li>2002, book, “Types and programming languages”, Benjamin C. Pierce</li>
            </ul>
          </li>
          <li>Java, Kotlin, Scala</li>
          <li>Things that annoy me
            <ul>
              <li>ML, SML, Caml, OCaml: <code class="highlighter-rouge">'a tf</code> is somewhat annoying. It should have been <code class="highlighter-rouge">tf a</code>.
                <ul>
                  <li>F# uses <code class="highlighter-rouge">tf&lt;'a&gt;</code>.</li>
                  <li>Haskell uses <code class="highlighter-rouge">Tf a</code>.</li>
                </ul>
              </li>
              <li>Would you rather type <code class="highlighter-rouge">'a list</code> (F#) or deal with an inadequate record/module system (Haskell)?</li>
              <li>Haskell doesn’t have <code class="highlighter-rouge">instance Read (-&gt;)</code> and <code class="highlighter-rouge">instance Show (-&gt;)</code>.
                <ul>
                  <li>Haskell expressions are not first-class citizen in the language.
                    <ul>
                      <li>Unlike Lisp/Scheme.</li>
                    </ul>
                  </li>
                  <li>Encumbers metaprogramming.</li>
                </ul>
              </li>
            </ul>
          </li>
          <li>OCaml labels and polymorphic variants?
            <ul>
              <li>http://caml.inria.fr/pub/docs/manual-ocaml-400/manual006.html</li>
              <li>OCaml labels are somewhat similar to Scheme keyword arguments.</li>
            </ul>
          </li>
          <li>F# quotations is important for metaprogramming.</li>
          <li>F# doesn’t do ad-hoc polymorphism well?
            <ul>
              <li><a href="https://withouttheloop.com/articles/2014-10-21-fsharp-adhoc-polymorphism/">Ad-hoc Polymorphism in F# (how to survive without Type Classes) - Without the loop</a></li>
              <li><a href="https://sidburn.github.io/blog/2016/03/24/higher-kinded-polymorphism">Higher-kinded Polymorphism: What is it, why you want it · David Raab</a></li>
            </ul>
          </li>
          <li>https://cstheory.stackexchange.com/questions/40705/why-did-caml-become-ocaml-or-why-use-objects-in-f</li>
          <li>ML begat Caml. Caml begat Caml Light? Caml Light begat OCaml?</li>
          <li><a href="https://www.quora.com/How-does-F-compare-to-OCaml-in-regard-to-major-syntactic-differences-paradigm-shifts-and-interoperability-with-Windows-What-about-its-numeric-capabilities">How does F# compare to OCaml, in regard to major syntactic differences, paradigm shifts, and interoperability with Windows? What about its numeric capabilities? - Quora</a>
            <ul>
              <li>Jon Harrop claims. More sources needed. Take it with a grain of salt.
                <ul>
                  <li>“OCaml has an integrated full-blown macro system in the form of Camlp4 whereas F# does not have macros and, in fact, has been deliberately closed off in order to discourage people from creating products that compete with Visual Studio.”
                    <ul>
                      <li>“deliberately closed off […]” is a bold claim.</li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="https://softwareengineering.stackexchange.com/questions/155239/are-all-languages-basically-the-same/155243">Are all languages basically the same? - Software Engineering Stack Exchange</a></li>
    </ul>
  </li>
  <li>package/dependency management tools
    <ul>
      <li>Java: Maven, Gradle</li>
      <li>OCaml: OPAM</li>
      <li>Haskell: Cabal, Stack</li>
      <li>F#: Paket? NuGet?</li>
      <li>C/C++: conan? chocolate? vcpkg?</li>
    </ul>
  </li>
  <li>Formally adding modules to lambda calculus
    <ul>
      <li>What is module calculus?
        <ul>
          <li>2017 article “Modules, Abstraction, and Parametric Polymorphism” <a href="https://www.cs.cmu.edu/~crary/papers/2017/mapp.pdf">pdf</a></li>
          <li>2003 article “A Type System for Higher-Order Modules” <a href="http://www.cs.cmu.edu/~rwh/papers/thoms/tr2.pdf">pdf</a></li>
          <li>2001 article “A Calculus of Module Systems” <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.22.5407">pdf available</a></li>
          <li>2012 course notes “Types for Module Systems” <a href="http://www.ccs.neu.edu/home/amal/course/7480-s12/modules-notes.pdf">pdf</a>
  from <a href="http://www.ccs.neu.edu/home/amal/course/7480-s12/">CS7480 Type Systems (Spring 2012)</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Ignored undocumented code sketches
    <ul>
      <li><a href="https://github.com/jordanlewis/simple-module-system">jordanlewis/simple-module-system: Adding modules to a polymorphic lambda calculus</a>, code in SML/NJ.</li>
    </ul>
  </li>
</ul>

  </div>

</article>

      </div>
    </main>

    
    
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
var disqus_config = function () {
    this.page.url = "https://edom.github.io/module.html";  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = "https://edom.github.io/module.html"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://edom-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    

    <footer class="site-footer h-card">
    <data class="u-url" href="/"></data>

    <div class="wrapper">
        <p>This page was created on 2018-08-22 00:12 +0700.</p>
        <p class="rss-subscribe">There is an <a href="/feed.xml">RSS feed</a>,
        but it's unused because this site is a wiki, not a blog.</p>
        <p>Stop writing books, papers, and blogs! Write a personal wiki instead! Or, even better, contribute to a community wiki.</p>
    </div>

</footer>


  </body>

</html>
